apiVersion: batch/v1
kind: CronJob
metadata:
  name: tamil-blasters-scraper
  namespace: mediafusion
  labels:
    app.kubernetes.io/name: tenant-cleaner  
spec:
  schedule: "0 */6 * * *" # run hourly
  concurrencyPolicy: Forbid # no more than one instance
  startingDeadlineSeconds: 60
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app.kubernetes.io/name: tamil-blasters-scraper
        spec:
          restartPolicy: Never
          containers:
          - name: "tamil-blasters-scraper"
            command: ["pipenv", "run", "python3", "-m", "scrapers.tamil_blasters", "--all"]
            image: ghcr.io/geek-cookbook/mediafusion:3.7.4@sha256:87c15876af36dcf098717f3d36743e8dc7890471efd904ee44cda1c0aaa48e6e
            securityContext:
              allowPrivilegeEscalation: false
              readOnlyRootFilesystem: true
              privileged: false
              seccompProfile:
                type: RuntimeDefault   
              runAsNonRoot: true
              runAsUser: 568
              runAsGroup: 568
              capabilities:
                drop:
                - ALL              
            envFrom:
            - secretRef:
                name: mediafusion-env 
            - configMapRef:
                name: mediafusion-env          
            volumeMounts:
            - mountPath: /.local
              name: local
            - mountPath: /tmp
              name: tmp
          volumes:
          - ephemeral:
              volumeClaimTemplate:
                metadata:
                  creationTimestamp: null
                spec:
                  accessModes:
                  - ReadWriteOnce
                  resources:
                    requests:
                      storage: 1Gi
                  storageClassName: topolvm-provisioner-thin
                  volumeMode: Filesystem
            name: local
          - ephemeral:
              volumeClaimTemplate:
                metadata:
                  creationTimestamp: null
                spec:
                  accessModes:
                  - ReadWriteOnce
                  resources:
                    requests:
                      storage: 1Gi
                  storageClassName: topolvm-provisioner-thin
                  volumeMode: Filesystem
            name: tmp